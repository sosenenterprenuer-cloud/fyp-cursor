{% extends "base.html" %}
{% block title %}Feedback Â· Personalized Learning Recommendation AI{% endblock %}
{% block content %}
  <section class="card">
    <h2>Share your feedback</h2>
    <form id="feedback-form" class="form-grid">
      <label>Rating (1 to 5)
        <select name="rating" required>
          <option value="">Select</option>
          {% for star in range(1, 6) %}
            <option value="{{ star }}">{{ star }} star{% if star > 1 %}s{% endif %}</option>
          {% endfor %}
        </select>
      </label>
      <label>Comments
        <textarea name="comment" rows="3" placeholder="What should we improve?" ></textarea>
      </label>
      <button type="submit" class="btn primary">Submit feedback</button>
    </form>
    <div class="notice success" id="feedback-success" hidden>Submitting...</div>
    <div class="notice warn" id="feedback-error" hidden></div>
  </section>
  <script>
    const form = document.getElementById('feedback-form');
    const successBox = document.getElementById('feedback-success');
    const errorBox = document.getElementById('feedback-error');
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      successBox.hidden = false;
      successBox.textContent = 'Submitting...';
      errorBox.hidden = true;
      const formData = new FormData(form);
      const payload = {
        rating: formData.get('rating'),
        comment: formData.get('comment')
      };
      try {
        const response = await fetch('{{ url_for('api_feedback') }}', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await response.json();
        if (!response.ok) {
          throw new Error(data.error || 'Unable to submit feedback.');
        }
        successBox.textContent = 'Feedback received! Redirecting...';
        if (data.redirect_url) {
          setTimeout(() => {
            window.location.href = data.redirect_url;
          }, 600);
        }
      } catch (error) {
        successBox.hidden = true;
        errorBox.hidden = false;
        errorBox.textContent = error.message;
      }
    });
  </script>
{% endblock %}
