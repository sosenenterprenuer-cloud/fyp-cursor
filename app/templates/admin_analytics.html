{% extends "base.html" %}
{% block title %}Analytics · Personalized Learning Recommendation AI{% endblock %}
{% block content %}
  <section class="card">
    <h2>Average time per student</h2>
    {% if per_student %}
      <table class="table">
        <thead><tr><th>Name</th><th>Email</th><th>Responses</th><th>Avg time (s)</th></tr></thead>
        <tbody>
          {% for row in per_student %}
            <tr>
              <td>{{ row['name'] }}</td>
              <td>{{ row['email'] }}</td>
              <td>{{ row['responses'] }}</td>
              <td>{{ row['avg_time']|round(2) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No response timing data yet.</p>
    {% endif %}
  </section>

  <section class="card">
    <h2>Per question timing</h2>
    <table class="table">
      <thead><tr><th>ID</th><th>Topic</th><th>Avg</th><th>Min</th><th>Max</th><th>Responses</th></tr></thead>
      <tbody>
        {% for row in per_question %}
          <tr>
            <td>{{ row['quiz_id'] }}</td>
            <td>{{ row['two_category'] or 'Unassigned' }}</td>
            <td>{{ row['avg_time']|default(0)|round(2) }}</td>
            <td>{{ row['min_time']|default(0)|round(2) }}</td>
            <td>{{ row['max_time']|default(0)|round(2) }}</td>
            <td>{{ row['responses'] }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="card">
    <h2>Slowest questions (n ≥ 5)</h2>
    {% if slowest %}
      <ol>
        {% for row in slowest %}
          <li>Q{{ row['quiz_id'] }} ({{ row['two_category'] or 'Unassigned' }}) – {{ row['avg_time']|round(2) }}s</li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="muted">No questions meet the minimum response count.</p>
    {% endif %}
  </section>

  <section class="card">
    <h2>Fastest questions (n ≥ 5)</h2>
    {% if fastest %}
      <ol>
        {% for row in fastest %}
          <li>Q{{ row['quiz_id'] }} ({{ row['two_category'] or 'Unassigned' }}) – {{ row['avg_time']|round(2) }}s</li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="muted">No questions meet the minimum response count.</p>
    {% endif %}
  </section>
{% endblock %}
