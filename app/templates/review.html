{% extends "base.html" %}
{% block title %}Attempt Review Â· Personalized Learning Recommendation AI{% endblock %}
{% block content %}
  <section class="card">
    <h2>Attempt Summary</h2>
    <p>Completed on <strong>{{ attempt['finished_at'] or attempt['started_at'] }}</strong></p>
    <p><strong>Score:</strong> {{ attempt['score_pct']|default(0) }}%</p>
    {% if feedback_flag %}
      <div class="notice success">Feedback has been submitted.</div>
    {% endif %}
    <div class="topic-grid">
      {% for topic, pct in per_topic_pct.items() %}
        <div class="topic-card">
          <h3>{{ topic }}</h3>
          <p>{{ pct }}%</p>
        </div>
      {% endfor %}
    </div>
    <h3>Lifetime best</h3>
    <ul>
      {% for topic, pct in best_by_topic.items() %}
        <li>{{ topic }}: {{ pct }}%</li>
      {% endfor %}
    </ul>
    {% if unlocked %}
      <div class="notice success">Great work! You unlocked the next recommendation: Database Development Process.</div>
    {% endif %}
    <p><a class="btn" href="{{ url_for('dashboard') }}">Back to dashboard</a></p>
  </section>

  <section class="card">
    <h2>Question Review</h2>
    <ol class="review-list">
      {% for item in responses %}
        <li class="review-item {% if not item.score %}incorrect{% endif %}">
          <h3>{{ item.question }}</h3>
          <p><strong>Your answer:</strong> {{ item.answer or 'No answer provided' }}</p>
          {% if not item.score %}
            <p><strong>Correct answer:</strong> {{ item.correct_answer }}</p>
          {% endif %}
          <p class="muted">{{ item.explanation }}</p>
          <p class="tag">Topic: {{ item.topic }}</p>
        </li>
      {% endfor %}
    </ol>
    <p class="muted">Need to share feedback? <a href="{{ url_for('thanks') }}">Rate this experience</a>.</p>
  </section>
{% endblock %}
