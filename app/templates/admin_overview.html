{% extends 'base.html' %}
{% block title %}Lecturer · Overview{% endblock %}
{% block content %}
<h2>Lecturer Overview</h2>
<p class="muted">Welcome back, {{ session.get('lecturer_name', 'Lecturer') }}. Here is a quick look at platform activity.</p>

<div class="cards overview-cards">
  <div class="card"><strong>Students</strong><div class="metric">{{ totals['students'] if totals else 0 }}</div></div>
  <div class="card"><strong>Attempts</strong><div class="metric">{{ totals['attempts'] if totals else 0 }}</div></div>
  <div class="card"><strong>Responses</strong><div class="metric">{{ totals['responses'] if totals else 0 }}</div></div>
</div>

<h3>Accuracy by Concept</h3>
<ul class="concept-breakdown">
  {% for r in by_cat %}
    <li><strong>{{ r['cat'] or '—' }}</strong>: {{ r['acc'] or 0 }}% (n={{ r['n'] }})</li>
  {% else %}
    <li class="muted">No responses recorded yet.</li>
  {% endfor %}
</ul>

<h3>Attempts (last 14 days)</h3>
<canvas id="attemptsChart" height="160"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ labels|tojson }};
  const counts = {{ counts|tojson }};
  const ctx = document.getElementById('attemptsChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Attempts',
        data: counts,
        borderColor: '#4f46e5',
        backgroundColor: 'rgba(79,70,229,0.15)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, precision: 0 } }
    }
  });
</script>

<p class="admin-links">
  <a class="btn" href="{{ url_for('admin_students') }}">View Students</a>
  <a class="btn" href="{{ url_for('admin_questions') }}">Question Performance</a>
</p>
{% endblock %}
